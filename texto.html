<!doctype html>
<html lang="es">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Voz (test)</title>
<style>
  html,body{margin:0;height:100%;background:#000;color:#9cf;font:14px/1.5 system-ui}
  #ui{position:fixed;left:16px;top:16px;z-index:9999}
  #btn{padding:8px 12px;border:0;border-radius:6px;background:#1e90ff;color:#fff;font-weight:700}
  #msg{margin-top:8px;white-space:pre-wrap;max-width:70vw}
  #out{position:fixed;left:16px;bottom:16px;color:#fff;font:700 28px/1.2 system-ui}
</style>
<div id="ui">
  <button id="btn" type="button">Iniciar</button>
  <div id="msg">Permite micrófono → clic “Iniciar”.</div>
</div>
<div id="out">di una palabra</div>
<script>
(() => {
  const btn = document.getElementById('btn');
  const msg = document.getElementById('msg');
  const out = document.getElementById('out');
  const log = t => { msg.textContent = t; console.log(t); };
  const add = t => { msg.textContent += "\n"+t; console.log(t); };

  const SR = window.webkitSpeechRecognition || window.SpeechRecognition;
  if(!SR){ log("Web Speech API no disponible (Chrome + https)."); return; }
  const recog = new SR();
  let on = false;

  recog.lang = "es-ES";          // probá "es-AR" si querés
  recog.interimResults = true;
  recog.continuous = true;

  recog.onstart = () => log("Escuchando…");
  recog.onresult = e => {
    const r = e.results[e.resultIndex];
    if(!r || !r[0]) return;
    const txt = r[0].transcript.trim();
    if(!txt) return;
    out.textContent = txt;
    add((r.isFinal?"Final: ":"Interim: ")+txt);
  };
  recog.onerror = e => { add("Error: "+e.error); };
  recog.onend = () => { add("End"); if(on){ try{recog.start();}catch(_){} } };

  btn.onclick = () => {
    if(!on){
      log("Arrancando… (si pide permiso, Aceptar)"); 
      on = true; btn.textContent = "Detener";
      try{ recog.start(); }catch(err){ add("No pude iniciar: "+err.message); }
    }else{
      on = false; btn.textContent = "Iniciar";
      try{ recog.stop(); }catch(_){} log("Detenido.");
    }
  };
})();
</script>
</html>
